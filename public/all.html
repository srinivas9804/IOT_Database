<!DOCTYPE HTML>
<html lang="en">
  <head>
    <title>Sensor Data</title>
  </head>
  <body>
    <h1>Sensor Data</h1>
    <script>
    	getData();

    	async function getData(){
    		const response = await fetch('/api');
    		const data = await response.json();
    		console.log(data);
    		if(data.length > 0){
    			const root = document.createElement('div');
    			var body = document.body,
        			table  = document.createElement('table');
        		table.style.width  = '100px';
    			table.style.border = '1px solid black';

    			const header = table.createTHead();
    			var row = header.insertRow(0);
    			var temp = row.insertCell(0);
    			var humid = row.insertCell(1);
    			var timestamp = row.insertCell(2);
    			temp.textContent = 'Temperature';
    			humid.textContent = 'Humidity';
    			timestamp.textContent = "Time";
    			temp.style.border = '1px solid black';
    			humid.style.border = '1px solid black';
    			timestamp.style.border = '1px solid black';
    			
    			for(item of data){
    				row = table.insertRow();
    				temp = row.insertCell(0);
    				humid = row.insertCell(1);
    				timestamp = row.insertCell(2);

    				temp.style.border = '1px solid black';
    				humid.style.border = '1px solid black';
    				timestamp.style.border = '1px solid black';

    				temp.textContent = `${item.temperature}`;
    				humid.textContent = `${item.humidity}`;
    				console.log(item.timestamp);
    				const dateString = new Date(item.timestamp).toLocaleString();
    				timestamp.textContent = dateString;
    			}
    			body.appendChild(table);
    		}
    		else{
    			document.write('<H1>No data to show</H1>');
    		}
    	}
    </script>
  </body>
</html>